<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Portal – RekaminAja</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "sans-serif"],
              mono: ["JetBrains Mono", "monospace"],
            },
            colors: {
              med: {
                primary: "#0ea5e9", // Sky Blue
                secondary: "#6366f1", // Indigo
                dark: "#0f172a", // Slate 900 custom
              },
            },
          },
        },
      };
    </script>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>

    <style>
      /* Custom Glass Effect */
      .glass-card {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      }

      /* Background Grid Animation vibe */
      .bg-grid {
        background-color: #0b0f19;
        background-image: radial-gradient(
            at 0% 0%,
            hsla(253, 16%, 7%, 1) 0,
            transparent 50%
          ),
          radial-gradient(at 50% 0%, hsla(225, 39%, 30%, 1) 0, transparent 50%),
          radial-gradient(at 100% 0%, hsla(339, 49%, 30%, 1) 0, transparent 50%);
      }
    </style>
  </head>

  <body
    class="bg-grid min-h-screen flex items-center justify-center text-slate-200 selection:bg-med-primary selection:text-white relative overflow-hidden"
  >
    <div
      class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-blue-600/20 rounded-full blur-[100px]"
    ></div>
    <div
      class="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-indigo-600/20 rounded-full blur-[100px]"
    ></div>

    <div
      class="glass-card w-full max-w-md p-10 rounded-2xl relative z-10 mx-4 transition-all duration-300 hover:shadow-blue-500/10 hover:border-blue-500/30"
    >
      <div class="text-center mb-10">
        <div
          class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-tr from-blue-500 to-indigo-600 mb-4 shadow-lg shadow-blue-500/30"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8 text-white"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
            />
          </svg>
        </div>
        <h2 class="text-3xl font-bold text-white tracking-tight">RekaminAja</h2>
        <p
          class="text-slate-400 text-sm mt-2 font-mono bg-slate-800/50 inline-block px-3 py-1 rounded-full border border-slate-700"
        >
          <span class="text-green-400">●</span> Secure Node Access
        </p>
      </div>

      <form method="POST" action="/login" id="loginForm" class="space-y-6">
        <input type="hidden" name="address" id="address" />
        <input type="hidden" name="signature" id="signature" />

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-300 ml-1">
            Admin Private Key
          </label>
          <div class="relative group">
            <div
              class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 text-slate-500 group-focus-within:text-blue-400 transition-colors"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"
                />
              </svg>
            </div>
            <input
              type="password"
              id="privateKey"
              placeholder="0x..."
              class="w-full pl-10 pr-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-white font-mono text-sm placeholder-slate-600 transition-all shadow-inner"
            />
          </div>
          <p class="text-xs text-slate-500 ml-1">
            *Key ini hanya disimpan di local storage browser Anda.
          </p>
        </div>

        <button
          type="button"
          onclick="login()"
          class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-3.5 rounded-lg shadow-lg shadow-blue-500/25 transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2 group"
        >
          <span>Authenticate Signature</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 group-hover:translate-x-1 transition-transform"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 10V3L4 14h7v7l9-11h-7z"
            />
          </svg>
        </button>
      </form>

      <div class="mt-8 text-center">
        <p class="text-xs text-slate-500 font-mono">
          Blockchain EMR System v1.0 <br />
          Powered by Web3.js
        </p>
      </div>
    </div>

    <script>
      const NONCE = "<%= nonce %>";

      async function login() {
        try {
          if (typeof Web3 === "undefined") {
            alert("Web3 gagal dimuat (CDN)");
            return;
          }

          let privateKey = localStorage.getItem("admin_private_key");

          if (!privateKey) {
            privateKey = document.getElementById("privateKey").value.trim();

            if (!privateKey.startsWith("0x") || privateKey.length !== 66) {
              alert("Private key tidak valid");
              return;
            }

            localStorage.setItem("admin_private_key", privateKey);
          }

          const web3 = new Web3();
          const account = web3.eth.accounts.privateKeyToAccount(privateKey);
          const signed = account.sign(NONCE);

          document.getElementById("address").value = account.address;
          document.getElementById("signature").value = signed.signature;

          document.getElementById("loginForm").submit();
        } catch (err) {
          alert("Login gagal: " + err.message);
        }
      }
    </script>
  </body>
</html>
